---
description: 
globs: 
alwaysApply: true
---
# Overview

- This project is a digitally accurate functional simulation of the MIT CADR Lisp Machine.
- This project is not a timing verification, hence no delays if it is not required for the function.
- This project will not be synthesized. It will be simulated using GHDL with LLVM backend.
- This project complies with VHDL-2008. You MUST write VHDL-2008 compliant code.

# Project Structure

- The project has four subdirectories containing vhd source files; ttl, dip, cadr and set.
- The ttl subdirectory contains the TTL components. These are put into sn74 and other packages.
- Ttl subdirectory also contains the misc package.
- The dip subdirectory contains the wrappers of TTL components, so called DIP components. These are put into dip package.
- The cadr subdirectory contains the MIT CADR schematic entities. These are put into cadr package.
- The set subdirectory contains the set components which are a combination of one or more cadr components.
- `cadr` entities depend on `dip`, `dip` entities depend on ttl packages (sn74, other, misc and unsorted).
- The project uses no other library, everything is put into the work library.
- `rom` directory contains the ROM/PROM data. rom/X_Y.hex is the data for ROM chip with designator Y on schematic page X.

## File Extensions

- `.vhd`: VHDL source files
- `.o`: Compiled object files
- `.cf`: GHDL design library files
- `_tb`: Executable testbench files
- `.ghw`: Waveform files

# Build System

The project uses a Makefile based build system.

There is only one Makefile, in the project root.

The build artifacts (work library, objects, executables) are put into the `build` directory.

Make targets are as follows.

- `make all`: Compile all
- `make ttl-check`: Run ttl testbenches
- `make check`: Run all testbenches
- `make clean`: Remove build artifacts (build directory)
- `make dist-clean`: In addition to `make clean`, remove also generated suds files

A single testbench (for example build/X_tb) can be run with `make run-X`. 

A single testbench (for example build/X_tb) can be run to create waveforms with `make wf-X`.

# Development Workflow

## Code Modification Guidelines

- NEVER modify the Makefile.
- NEVER modify port list, package and component definitions unless specifically instructed to do so.
- After changing a source file, run `make` to see everything compiles fine.
- DO NOT write testbenches on your own without asking.

## Git Workflow

- NEVER automatically commit changes.
- When creating a commit message, summarize the changes in bullet-points and add "Co-Authored-By: Cursor <noreply@metebalci.com>" on its own line at the end.

# Differences from datasheets

- SN74241 BENB is implemented as active high even though it is active low in the datasheet.

# Notes

- dip_5600 and dip_5610 both uses im5600. im5600 and im5610 are digitally equivalent.
- Use `rom/dspctl_2f22.hex` for the testbenches related to im5600.
- Use `rom/prom0_1b17.hex` for the testbenches related to sn74472 and dm74472.
- The signal \machruna l\ is named correct, do not try to fix it.

# Resources

- CADR Schematics are in the PNG files linked from this URL: https://tumbleweed.nu/lm-3/schematics.html
- Component datasheets for TTL logic families
- VHDL-2008 language reference
- GHDL documentation at https://ghdl.github.io/ghdl/
